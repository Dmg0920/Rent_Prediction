# é€²éšçµ±è¨ˆåˆ†æèˆ‡æ©Ÿå™¨å­¸ç¿’åŠŸèƒ½

æœ¬å°ˆæ¡ˆå±•ç¤ºäº†**çµ±è¨ˆé©…å‹•çš„æ©Ÿå™¨å­¸ç¿’æ–¹æ³•**ï¼Œçµåˆåš´è¬¹çš„çµ±è¨ˆæ¨è«–èˆ‡ç¾ä»£æ©Ÿå™¨å­¸ç¿’æŠ€è¡“ã€‚

## ğŸ“Š æ ¸å¿ƒåŠŸèƒ½

### 1. çµ±è¨ˆç‰¹å¾µåˆ†æ (`analysis/feature_analyzer.py`)

#### 1.1 ç›¸é—œæ€§åˆ†æ
- **Pearson ç›¸é—œä¿‚æ•¸**ï¼šæª¢æ¸¬ç·šæ€§é—œä¿‚
- **Spearman ç§©ç›¸é—œ**ï¼šæª¢æ¸¬å–®èª¿é—œä¿‚
- è‡ªå‹•æ¨™è¨»é¡¯è‘—æ€§æ°´æº–ï¼ˆ***å¼·ç›¸é—œï¼Œ**ä¸­ç­‰ç›¸é—œï¼Œ*å¼±ç›¸é—œï¼‰

#### 1.2 å¤šé‡å…±ç·šæ€§è¨ºæ–· (VIF)
- **è®Šç•°æ•¸è†¨è„¹å› å­ (Variance Inflation Factor)**
- VIF > 10 è¡¨ç¤ºåš´é‡å…±ç·šæ€§
- è‡ªå‹•æ¨™è¨»éœ€è¦è™•ç†çš„ç‰¹å¾µ

#### 1.3 äº’ä¿¡æ¯åˆ†æ
- æª¢æ¸¬**éç·šæ€§ç›¸ä¾é—œä¿‚**
- æ¯”Pearsonç›¸é—œæ›´å…¨é¢
- é©åˆç™¼ç¾è¤‡é›œçš„ç‰¹å¾µ-ç›®æ¨™é—œä¿‚

#### 1.4 å¡æ–¹ç¨ç«‹æ€§æª¢é©—
- æ¸¬è©¦é¡åˆ¥è®Šæ•¸èˆ‡ç›®æ¨™çš„é—œè¯æ€§
- æä¾›på€¼å’Œçµ±è¨ˆé¡¯è‘—æ€§åˆ¤æ–·

### 2. é›†æˆå­¸ç¿’æ¨¡å‹ (`models/ensemble_models.py`)

#### æ”¯æ´çš„æ¨¡å‹ï¼š
1. **Random Forest**ï¼šåŸºæ–¼æ±ºç­–æ¨¹çš„é›†æˆæ–¹æ³•
2. **Gradient Boosting**ï¼šæ¢¯åº¦æå‡æ¨¹
3. **XGBoost**ï¼šæ¥µé™æ¢¯åº¦æå‡ï¼ˆéœ€å®‰è£xgboostï¼‰
4. **LightGBM**ï¼šè¼•é‡ç´šæ¢¯åº¦æå‡ï¼ˆéœ€å®‰è£lightgbmï¼‰

#### åŠŸèƒ½ï¼š
- **ç‰¹å¾µé‡è¦æ€§åˆ†æ**ï¼šè­˜åˆ¥æœ€é‡è¦çš„é æ¸¬å› å­
- **äº¤å‰é©—è­‰**ï¼šæ›´ç©©å¥çš„æ•ˆèƒ½è©•ä¼°
- **æ¨¡å‹é›†æˆ**ï¼šçµåˆå¤šå€‹æ¨¡å‹çš„é æ¸¬ï¼ˆå¹³å‡æˆ–åŠ æ¬Šï¼‰
- **è‡ªå‹•æ•ˆèƒ½æ¯”è¼ƒ**ï¼šRÂ², RMSE, MAE, MAPE

### 3. çµ±è¨ˆå‡è¨­æª¢é©— (`analysis/model_evaluator.py`)

#### 3.1 é…å° t æª¢é©—
- æ¯”è¼ƒå…©å€‹æ¨¡å‹çš„é æ¸¬èª¤å·®æ˜¯å¦æœ‰é¡¯è‘—å·®ç•°
- æä¾›tçµ±è¨ˆé‡ã€på€¼å’Œä¿¡è³´å€é–“

#### 3.2 Diebold-Mariano æª¢é©—
- å°ˆé–€ç”¨æ–¼é æ¸¬æº–ç¢ºåº¦æ¯”è¼ƒ
- é©åˆæ™‚é–“åºåˆ—å’Œä¸€èˆ¬è¿´æ­¸æ¨¡å‹

#### 3.3 Friedman æª¢é©—
- éåƒæ•¸æ–¹æ³•ï¼Œæ¯”è¼ƒ3å€‹ä»¥ä¸Šæ¨¡å‹
- ä¸éœ€è¦å¸¸æ…‹æ€§å‡è¨­

#### 3.4 Bootstrap ä¿¡è³´å€é–“
- ä¼°è¨ˆæ¨¡å‹æ•ˆèƒ½æŒ‡æ¨™çš„ä¸ç¢ºå®šæ€§
- æä¾›95%ä¿¡è³´å€é–“
- æ”¯æ´ä»»æ„è©•ä¼°æŒ‡æ¨™

#### 3.5 å­¸ç¿’æ›²ç·šåˆ†æ
- è¨ºæ–·**åå·®-è®Šç•°æ•¸æ¬Šè¡¡**
- è­˜åˆ¥éæ“¬åˆæˆ–æ¬ æ“¬åˆå•é¡Œ
- åˆ¤æ–·æ˜¯å¦éœ€è¦æ›´å¤šæ•¸æ“š

#### 3.6 æ®˜å·®åˆ†æ
- æ®˜å·®åœ–ï¼šæª¢æŸ¥è®Šç•°æ•¸é½Šä¸€æ€§
- Q-Qåœ–ï¼šæª¢é©—å¸¸æ…‹æ€§å‡è¨­
- ç›´æ–¹åœ–ï¼šè¦–è¦ºåŒ–èª¤å·®åˆ†ä½ˆ

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å®‰è£ä¾è³´
```bash
pip install -r requirements.txt
```

### åŸ·è¡Œé€²éšåˆ†æ
```bash
cd ml
python scripts/advanced_analysis.py
```

### åœ¨è‡ªå·±çš„ä»£ç¢¼ä¸­ä½¿ç”¨

#### 1. ç‰¹å¾µåˆ†æ
```python
from analysis.feature_analyzer import FeatureAnalyzer

analyzer = FeatureAnalyzer(df, target_col='ç¸½é¡å…ƒ')

# ç›¸é—œæ€§åˆ†æ
corr = analyzer.correlation_analysis(method='pearson', top_n=20)

# VIFåˆ†æ
vif = analyzer.vif_analysis(threshold=10)

# äº’ä¿¡æ¯åˆ†æ
mi = analyzer.mutual_information_analysis(top_n=20)
```

#### 2. è¨“ç·´é›†æˆæ¨¡å‹
```python
from models.ensemble_models import EnsembleModelTrainer

trainer = EnsembleModelTrainer(random_state=42)

# è¨“ç·´æ‰€æœ‰æ¨¡å‹
results = trainer.train_all_models(
    X_train, y_train, X_test, y_test, use_log=True
)

# æŸ¥çœ‹ç‰¹å¾µé‡è¦æ€§
importance = trainer.get_feature_importance(
    'Random Forest', feature_names, top_n=20
)

# æ¯”è¼ƒæ¨¡å‹
comparison = trainer.compare_models()
```

#### 3. çµ±è¨ˆæª¢é©—
```python
from analysis.model_evaluator import ModelEvaluator

evaluator = ModelEvaluator(random_state=42)

# é…å°tæª¢é©—
t_result = evaluator.paired_t_test(pred1, pred2, y_test)

# Bootstrapä¿¡è³´å€é–“
ci = evaluator.bootstrap_confidence_interval(
    y_test, predictions,
    metric_func=lambda y, p: np.sqrt(mean_squared_error(y, p)),
    n_bootstrap=1000
)

# å­¸ç¿’æ›²ç·š
lc = evaluator.learning_curve_analysis(model, X, y, cv=5)
```

## ğŸ“ˆ è¼¸å‡ºç¤ºä¾‹

### ç›¸é—œæ€§åˆ†æ
```
============================================================
ç›¸é—œæ€§åˆ†æ (Pearson Correlation)
============================================================

èˆ‡ ç¸½é¡å…ƒ ç›¸é—œæ€§æœ€é«˜çš„å‰ 15 å€‹ç‰¹å¾µï¼š

 1. åªæ•¸                          :  0.8234 ***
 2. å»ºç‰©ç¸½é¢ç©å¹³æ–¹å…¬å°º              :  0.7891 ***
 3. å»ºç‰©ç¾æ³æ ¼å±€-æˆ¿                :  0.6543 ***
 4. æœ‰é›»æ¢¯                        :  0.5234 ***
 5. ç¸½æ¨“å±¤æ•¸                      :  0.4567 **
...
```

### VIFåˆ†æ
```
============================================================
å¤šé‡å…±ç·šæ€§è¨ºæ–· (VIF Analysis)
============================================================

ç‰¹å¾µ                           VIF         è¨ºæ–·
------------------------------------------------------------
å»ºç‰©ç¸½é¢ç©å¹³æ–¹å…¬å°º              45.67      âš ï¸ åš´é‡å…±ç·šæ€§
åªæ•¸                           42.34      âš ï¸ åš´é‡å…±ç·šæ€§
å»ºç‰©ç¾æ³æ ¼å±€-æˆ¿                 8.23      âš¡ ä¸­ç­‰å…±ç·šæ€§
ç¸½æ¨“å±¤æ•¸                        3.45      âœ“ æ­£å¸¸
...
```

### æ¨¡å‹æ¯”è¼ƒ
```
============================================================
æ¨¡å‹æ•ˆèƒ½æ¯”è¼ƒ
============================================================

æ¨¡å‹                    RÂ²         RMSE          MAE       MAPE
----------------------------------------------------------------------
XGBoost            0.8456      4,234         3,123     12.34%
Random Forest      0.8234      4,567         3,456     13.45%
Gradient Boosting  0.8123      4,789         3,678     14.56%
```

### çµ±è¨ˆæª¢é©—
```
============================================================
é…å° t æª¢é©— (Paired t-test)
============================================================

å‡è¨­æª¢é©—ï¼š
  Hâ‚€: å…©æ¨¡å‹å¹³å‡èª¤å·®ç›¸åŒ
  Hâ‚: å…©æ¨¡å‹å¹³å‡èª¤å·®ä¸åŒ
  é¡¯è‘—æ°´æº– Î± = 0.05

æª¢é©—çµæœï¼š
  t çµ±è¨ˆé‡ = 3.4567
  p å€¼ = 0.0012
  å¹³å‡èª¤å·®å·®ç•° = 234.56
  èª¤å·®å·®ç•°æ¨™æº–å·® = 456.78

çµè«–: âœ“ æ‹’çµ• Hâ‚€ (p < 0.05)
  å…©æ¨¡å‹çš„é æ¸¬èª¤å·®æœ‰é¡¯è‘—å·®ç•°
```

## ğŸ¯ å°ˆæ¥­åƒ¹å€¼

é€™å€‹é€²éšåˆ†ææ¡†æ¶å±•ç¤ºäº†ä»¥ä¸‹å°ˆæ¥­æŠ€èƒ½ï¼š

### çµ±è¨ˆå­¸å°ˆæ¥­
1. **å‡è¨­æª¢é©—**ï¼štæª¢é©—ã€å¡æ–¹æª¢é©—ã€Friedmanæª¢é©—
2. **å¤šè®Šé‡åˆ†æ**ï¼šç›¸é—œæ€§ã€å…±ç·šæ€§è¨ºæ–·
3. **éåƒæ•¸æ–¹æ³•**ï¼šSpearmanç›¸é—œã€ç§©æª¢é©—
4. **é‡æŠ½æ¨£æ–¹æ³•**ï¼šBootstrapä¿¡è³´å€é–“
5. **æ¨¡å‹è¨ºæ–·**ï¼šæ®˜å·®åˆ†æã€Q-Qåœ–

### æ©Ÿå™¨å­¸ç¿’å°ˆæ¥­
1. **é›†æˆå­¸ç¿’**ï¼šRandom Forestã€Boostingã€Stacking
2. **ç‰¹å¾µå·¥ç¨‹**ï¼šäº’ä¿¡æ¯ã€ç‰¹å¾µé‡è¦æ€§
3. **æ¨¡å‹è©•ä¼°**ï¼šäº¤å‰é©—è­‰ã€å­¸ç¿’æ›²ç·š
4. **ä¸ç¢ºå®šæ€§é‡åŒ–**ï¼šé æ¸¬å€é–“ã€ä¿¡è³´å€é–“

### å¯¦å‹™æ‡‰ç”¨èƒ½åŠ›
1. **æ¨¡å‹æ¯”è¼ƒ**ï¼šåš´è¬¹çš„çµ±è¨ˆæª¢é©—ï¼Œè€Œéåƒ…æ†‘æŒ‡æ¨™
2. **å¯è§£é‡‹æ€§**ï¼šç‰¹å¾µé‡è¦æ€§ã€SHAPå€¼åŸºç¤
3. **ç©©å¥æ€§**ï¼šBootstrapã€äº¤å‰é©—è­‰
4. **è¨ºæ–·èƒ½åŠ›**ï¼šè­˜åˆ¥éæ“¬åˆã€æ¬ æ“¬åˆã€å…±ç·šæ€§
